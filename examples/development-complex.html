<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PeekPlayer Development Controls</title>
  <link rel="stylesheet" href="../style.css">
  <style>
    body {
      flex-direction: column;
      gap: 24px;
      padding: 24px;
      box-sizing: border-box;
    }

    .dev-layout {
      display: grid;
      grid-template-columns: minmax(0, 1fr) 320px;
      gap: 24px;
      width: 100%;
      max-width: 1200px;
    }

    #dev-controls {
      background: rgba(34, 34, 34, 0.95);
      border-radius: 12px;
      padding: 16px 18px;
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.35);
      color: #f5f5f5;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    #dev-controls h2 {
      margin: 0 0 12px 0;
      font-size: 18px;
      font-weight: 600;
    }

    .control-group {
      margin-bottom: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      padding-bottom: 12px;
    }

    .control-group:last-of-type {
      border-bottom: none;
      padding-bottom: 0;
      margin-bottom: 0;
    }

    .control-group h3 {
      margin: 0 0 8px 0;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(255, 255, 255, 0.7);
    }

    .toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 6px 0;
      font-size: 14px;
    }

    .toggle label {
      display: flex;
      gap: 8px;
      align-items: center;
      cursor: pointer;
    }

    .toggle input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    button.dev-action {
      width: 100%;
      margin-top: 10px;
      padding: 10px 14px;
      border-radius: 8px;
      border: none;
      color: #111;
      background: linear-gradient(135deg, #00ff88, #00b3ff);
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.18s ease;
    }

    button.dev-action:hover {
      transform: translateY(-1px);
    }

    .status-line {
      font-size: 13px;
      margin: 4px 0 0 0;
      color: rgba(255, 255, 255, 0.65);
    }

    @media (max-width: 768px) {
  .dev-layout {
    display: flex;
    flex-direction: column;
  }
  #dev-controls {
    width: 100%;
    max-width: none;
  }
}
  </style>
</head>
<body>
  <h1 style="color:#fff;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;margin:0;">PeekPlayer Dev Controls Playground</h1>
  <div class="dev-layout">
    <div id="player-wrapper">
      <video id="peek-video" playsinline webkit-playsinline preload="auto" crossorigin=""></video>
      <div id="custom-controls"></div>
      <div id="overlay-container"></div>
    </div>

    <aside id="dev-controls">
      <h2>Runtime Tweaks</h2>

      <div class="control-group">
        <h3>Playback</h3>
        <div class="toggle">
          <label for="toggle-autoplay">
            <input type="checkbox" id="toggle-autoplay">
            <span>Autoplay</span>
          </label>
        </div>
        <div class="toggle">
          <label for="toggle-auto-next">
            <input type="checkbox" id="toggle-auto-next">
            <span>Auto Next</span>
          </label>
        </div>
        <div class="toggle">
          <label for="toggle-auto-unmute">
            <input type="checkbox" id="toggle-auto-unmute">
            <span>Auto Unmute on Interaction</span>
          </label>
        </div>
      </div>

      <div class="control-group">
        <h3>Controls Visibility</h3>
        <div class="toggle">
          <label for="toggle-skip-previous">
            <input type="checkbox" id="toggle-skip-previous" checked>
            <span>Show Skip Previous</span>
          </label>
        </div>
        <div class="toggle">
          <label for="toggle-skip-next">
            <input type="checkbox" id="toggle-skip-next" checked>
            <span>Show Skip Next</span>
          </label>
        </div>
        <div class="toggle">
          <label for="toggle-pip">
            <input type="checkbox" id="toggle-pip" checked>
            <span>Show Picture-in-Picture</span>
          </label>
        </div>
      </div>

      <div class="control-group">
        <h3>Utilities</h3>
        <button class="dev-action" id="refresh-controls">Refresh Controls Layout</button>
        <p class="status-line" id="player-status">Waiting for playerâ€¦</p>
      </div>

      <div class="control-group">
        <h3>Segments</h3>
        <div class="toggle">
          <label for="toggle-segment-autoskip">
            <input type="checkbox" id="toggle-segment-autoskip">
            <span>Enable Segment Auto-Skip</span>
          </label>
        </div>
        <div class="toggle">
          <label for="segment-autoskip-labels">
            <span>Skip Labels (comma separated)</span>
          </label>
        </div>
        <input id="segment-autoskip-labels" type="text" placeholder="Intro, Recap" style="width:100%;padding:6px 8px;border-radius:6px;border:none;margin-bottom:8px;" />
        <div class="toggle">
          <label for="segment-autoskip-offset">
            <span>Offset After Skip (seconds)</span>
          </label>
        </div>
        <input id="segment-autoskip-offset" type="number" min="0" step="0.1" value="0" style="width:100%;padding:6px 8px;border-radius:6px;border:none;" />
      </div>
    </aside>
  </div>

  <script defer src="https://cdn.jsdelivr.net/npm/hls.js@1.5.20/dist/hls.min.js"></script>
  <script defer type="module" src="demo.js"></script>
  <script type="module">
    const statusLine = document.getElementById('player-status');

    function waitForPlayer(timeoutMs = 8000) {
      return new Promise((resolve, reject) => {
        if (window.peekPlayer) {
          resolve(window.peekPlayer);
          return;
        }

        const start = Date.now();
        const interval = setInterval(() => {
          if (window.peekPlayer) {
            clearInterval(interval);
            resolve(window.peekPlayer);
          } else if (Date.now() - start > timeoutMs) {
            clearInterval(interval);
            reject(new Error('Timed out waiting for PeekPlayer instance'));
          }
        }, 60);
      });
    }

    function syncUI(player) {
      const controlsConfig = player.options.controls || {};
      const autoSkipOptions = player.options.segmentAutoSkip || null;

      document.getElementById('toggle-autoplay').checked = !!player.autoplay;
      document.getElementById('toggle-auto-next').checked = !!player.autoNext;
      document.getElementById('toggle-auto-unmute').checked = !!player.autoUnmuteOnInteraction;
      document.getElementById('toggle-skip-previous').checked = controlsConfig.skipPrevious !== false;
      document.getElementById('toggle-skip-next').checked = controlsConfig.skipNext !== false;
      document.getElementById('toggle-pip').checked = controlsConfig.pip !== false;
      document.getElementById('toggle-segment-autoskip').checked = !!autoSkipOptions;

      const labelsField = document.getElementById('segment-autoskip-labels');
      const offsetField = document.getElementById('segment-autoskip-offset');

      if (autoSkipOptions) {
        const labels = Array.isArray(autoSkipOptions.labels)
          ? autoSkipOptions.labels
          : Array.from(autoSkipOptions.labels || []);
        labelsField.value = labels.join(', ');
        offsetField.value = typeof autoSkipOptions.offsetAfter === 'number' ? autoSkipOptions.offsetAfter : 0;
      } else {
        labelsField.value = '';
        offsetField.value = 0;
      }
    }

    function initDevControls(player) {
      statusLine.textContent = 'Player ready';
      syncUI(player);

      document.getElementById('toggle-autoplay').addEventListener('change', (event) => {
        player.updateOptions({ autoplay: event.target.checked });
      });

      document.getElementById('toggle-auto-next').addEventListener('change', (event) => {
        player.updateOptions({ autoNext: event.target.checked });
      });

      document.getElementById('toggle-auto-unmute').addEventListener('change', (event) => {
        player.updateOptions({ autoUnmuteOnInteraction: event.target.checked });
      });

      document.getElementById('toggle-skip-previous').addEventListener('change', (event) => {
        player.updateOptions({ controls: { skipPrevious: event.target.checked } });
      });

      document.getElementById('toggle-skip-next').addEventListener('change', (event) => {
        player.updateOptions({ controls: { skipNext: event.target.checked } });
      });

      document.getElementById('toggle-pip').addEventListener('change', (event) => {
        player.updateOptions({ controls: { pip: event.target.checked } });
      });

      document.getElementById('refresh-controls').addEventListener('click', () => {
        player.refreshControls();
        statusLine.textContent = 'Controls refreshed at ' + new Date().toLocaleTimeString();
      });

      document.getElementById('toggle-segment-autoskip').addEventListener('change', (event) => {
        console.log(event.target.checked);
        const enabled = event.target.checked;
        if (!enabled) {
          player.updateOptions({ segmentAutoSkip: null });
          return;
        }

        const labels = parseLabelInput(document.getElementById('segment-autoskip-labels').value);
        const offsetAfter = parseFloat(document.getElementById('segment-autoskip-offset').value) || 0;
        player.updateOptions({
          segmentAutoSkip: {
            labels,
            offsetAfter,
          }
        });
      });

      document.getElementById('segment-autoskip-labels').addEventListener('blur', () => {
        if (!document.getElementById('toggle-segment-autoskip').checked) {
          return;
        }

        const labels = parseLabelInput(document.getElementById('segment-autoskip-labels').value);
        player.updateOptions({
          segmentAutoSkip: {
            ...(player.options.segmentAutoSkip || {}),
            labels
          }
        });
      });

      document.getElementById('segment-autoskip-offset').addEventListener('blur', () => {
        if (!document.getElementById('toggle-segment-autoskip').checked) {
          return;
        }

        const offsetAfter = parseFloat(document.getElementById('segment-autoskip-offset').value) || 0;
        player.updateOptions({
          segmentAutoSkip: {
            ...(player.options.segmentAutoSkip || {}),
            offsetAfter
          }
        });
      });
    }

    waitForPlayer()
      .then((player) => initDevControls(player))
      .catch((error) => {
        statusLine.textContent = 'Player failed to initialize';
        console.error('PeekPlayer dev controls failed to attach:', error);
      });

    function parseLabelInput(input) {
      return input
        .split(',')
        .map((label) => label.trim())
        .filter(Boolean);
    }
  </script>
</body>
</html>
